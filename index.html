<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watercore | Réservation</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { 
            --watercore-blue: #0ea5e9; 
            --watercore-dark: #0c4a6e; 
            --bg: #f8fafc; 
        }
        
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background: radial-gradient(circle at top, #e0f2fe 0%, #f8fafc 100%); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
        }

        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 24px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); 
            width: 100%; 
            max-width: 400px; 
            border: 1px solid rgba(14, 165, 233, 0.1);
        }

        .logo {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--watercore-dark);
            margin-bottom: 2rem;
            letter-spacing: -1px;
        }

        .logo span { color: var(--watercore-blue); }

        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-top: 15px; 
            max-height: 320px; 
            overflow-y: auto; 
            padding: 5px;
        }

        .slot { 
            padding: 14px; 
            background: #f1f5f9; 
            border: 2px solid transparent; 
            border-radius: 12px; 
            text-align: center; 
            cursor: pointer; 
            font-weight: 600; 
            color: #475569;
            transition: all 0.2s; 
        }

        .slot:hover { border-color: var(--watercore-blue); background: #f0f9ff; }
        .slot.selected { background: var(--watercore-blue); color: white; border-color: var(--watercore-dark); }

        input, button { 
            width: 100%; 
            padding: 14px; 
            margin-top: 12px; 
            border-radius: 12px; 
            border: 1px solid #e2e8f0; 
            box-sizing: border-box; 
            font-size: 1rem;
        }

        input:focus { outline: none; border-color: var(--watercore-blue); ring: 2px solid #bae6fd; }

        button { 
            background: var(--watercore-dark); 
            color: white; 
            border: none; 
            font-weight: 700; 
            cursor: pointer; 
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.98); }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }

        .success-box { 
            display: none; 
            background: #f0fdf4; 
            color: #166534; 
            padding: 15px; 
            border-radius: 12px; 
            text-align: center; 
            margin-top: 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="logo">WATER<span>CORE</span></div>

    <div id="login-screen" class="screen active">
        <p style="text-align:center; color:#64748b; margin-top:-15px; margin-bottom:20px;">Portail de réservation</p>
        <input type="text" id="user-name" placeholder="Votre nom complet">
        <button onclick="enterApp()">Accéder au planning</button>
    </div>

    <div id="booking-screen" class="screen">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h4 style="margin:0; color:var(--watercore-dark)">Planning du jour</h4>
            <span style="font-size:0.7rem; background:#e0f2fe; padding:4px 8px; border-radius:20px; color:var(--watercore-dark)">9h - 16h</span>
        </div>
        
        <div id="grid" class="grid"></div>
        
        <div id="confirm-area" style="display:none; margin-top:20px; padding-top:15px; border-top: 1px solid #f1f5f9;">
            <p id="summary" style="font-size:0.9rem; color:#475569; margin-bottom:15px;"></p>
            <button id="send-btn" onclick="confirmBooking()">Confirmer la session</button>
        </div>
        
        <div id="msg" class="success-box">Plouf ! Session réservée avec succès.</div>
    </div>
</div>

<script>
    // CONFIGURATION WATERCORE
    const P_KEY = "BAfMFTCd2YLwvXa7c";
    const S_ID = "service_vlw8hol";
    const T_ID = "template_j897y78"; // <--- Assurez-vous que cet ID est correct

    emailjs.init(P_KEY);

    let clientName = "";
    let selectedSlot = "";

    function enterApp() {
        clientName = document.getElementById('user-name').value;
        if(clientName.length < 2) return alert("Veuillez entrer votre nom.");
        
        document.getElementById('login-screen').classList.remove('active');
        document.getElementById('booking-screen').classList.add('active');
        
        const grid = document.getElementById('grid');
        grid.innerHTML = ""; // Reset grid
        
        // Génération 9h - 16h par tranches de 30 min
        for(let h=9; h<16; h++) {
            createSlot(`${h}:00`, `${h}:30`);
            createSlot(`${h}:30`, `${h+1}:00`);
        }
    }

    function createSlot(start, end) {
        const div = document.createElement('div');
        div.className = 'slot';
        div.innerText = start + " - " + end;
        div.onclick = () => {
            document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
            div.classList.add('selected');
            selectedSlot = div.innerText;
            document.getElementById('confirm-area').style.display = 'block';
            document.getElementById('summary').innerHTML = `Session pour <b>${clientName}</b><br>Créneau : <b>${selectedSlot}</b>`;
        };
        document.getElementById('grid').appendChild(div);
    }

    function confirmBooking() {
        const btn = document.getElementById('send-btn');
        btn.disabled = true;
        btn.innerText = "Traitement...";

        const params = {
            user_name: clientName,
            time_slot: selectedSlot
        };

        emailjs.send(S_ID, T_ID, params)
            .then(() => {
                document.getElementById('confirm-area').style.display = 'none';
                document.getElementById('msg').style.display = 'block';
                setTimeout(() => location.reload(), 3000);
            })
            .catch(err => {
                alert("Erreur de connexion. Vérifiez vos paramètres EmailJS.");
                btn.disabled = false;
                btn.innerText = "Réessayer";
            });
    }
</script>

</body>
</html>
